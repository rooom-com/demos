<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fashion-Tech: Female</title>
    <link rel="dns-prefetch" href="https://storage.rooom.com" />

    <script
      type="text/javascript"
      src="https://static.rooom.com/viewer-api/product-viewer-1.0.0.min.js"
    ></script>
    <style>
      *,
      *::before,
      *::after {
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
      }

      iframe {
        border: none;
      }

      body {
        margin: 0;
        min-height: 100vh;
        scroll-behavior: smooth;
        text-rendering: optimizeSpeed;
        line-height: 1.5;
        font-family: Arial, Helvetica, sans-serif;
      }

      button {
        font: inherit;
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          -webkit-animation-duration: 0.01ms !important;
          animation-duration: 0.01ms !important;
          -webkit-animation-iteration-count: 1 !important;
          animation-iteration-count: 1 !important;
          -webkit-transition-duration: 0.01ms !important;
          -o-transition-duration: 0.01ms !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }

      .container {
        position: relative;
        width: 100%;
        height: 100vh;
        overflow: hidden;
      }

      .button-containers {
        position: absolute;
        top: 20px;
        right: 20px;
      }

      .buttons-table-container {
        margin-bottom: 20px;
      }

      .buttons-table-container div.title {
        text-align: right;
        font-weight: bold;
      }

      button {
        width: 40px;
        height: 40px;
        padding: 0;
        margin: 0 0 0 10px;
        display: block;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        background-size: cover;
      }

      .buttons-table button {
        float: left;
      }

      #viewer {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="button-containers">
        <!-- Autogenerated -->
      </div>
      <!-- Insert an empty iframe -->
      <iframe
        src=""
        id="viewer"
        allow="autoplay; fullscreen; vr; xr"
        allowvr
        allowfullscreen
        mozallowfullscreen="true"
        webkitallowfullscreen="true"
      ></iframe>
    </div>
    <!-- Initialize the viewer -->
    <script type="text/javascript">
      window.onload = function () {
        const iframe = document.getElementById("viewer");
        const id = "bf6a8a82f258b80f6e3ed830321fe0";

        const viewer = new ProductViewer(iframe);

        viewer.init(id, {
          transparent: true,
          skybox: false,
          autostart: true,
          camera_collision: false,
          ui_controls: false,
          ui_infos: false,
          ui_help: false,
          ui_hint: 0,
          render_background: true,
          ui_logo: false,
          onSuccess: function onSuccessFn(api) {
            let materials = [
              {
                title: "Coat",
                key: "coat",
                variants: [
                  {
                    type: "texture",
                    data: "assets/female_coat_03.jpg",
                  },
                  {
                    type: "texture",
                    data: "assets/female_coat_02.jpg",
                  },
                  {
                    type: "texture",
                    data: "assets/female_coat_01.jpg",
                  },
                ],
              },
              {
                title: "Buttons",
                key: "buttons",
                variants: [
                  { type: "color", data: "#000000" },
                  { type: "color", data: "#38312B" },
                  { type: "color", data: "#7D7D7D" },
                ],
              },
              {
                title: "Dress",
                key: "dress",
                variants: [
                  {
                    type: "texture",
                    data: "assets/female_dress_01.jpg",
                  },
                  {
                    type: "texture",
                    data: "assets/female_dress_02.jpg",
                  },
                  {
                    type: "texture",
                    data: "assets/female_dress_03.jpg",
                  },
                ],
              },
              {
                title: "Bag",
                key: "bag",
                variants: [
                  {
                    type: "texture",
                    data: "assets/female_bag_01.jpg",
                  },
                  {
                    type: "texture",
                    data: "assets/female_bag_02.jpg",
                  },
                ],
              },
              {
                title: "Shoes",
                key: "shoes",
                variants: [
                  { type: "color", data: "#000000" },
                  { type: "color", data: "#6D0B12" },
                  { type: "color", data: "#8D927E" },
                ],
              },
            ];

            api.on("viewer.start", function () {
              api.setCameraPosition([2, 2, -2], 1);
              let meshMaterials = [];
              api.getMaterials(function (matSets) {
                meshMaterials = matSets;
                // Mannequin color
                let skinMaterial = meshMaterials.find(
                  (m) => m.id === "mannequin"
                );
                skinMaterial.channels.albedoColor.color = "#111111";
                api.setMaterial(skinMaterial);

                var e = document.getElementsByClassName("button-containers")[0];
                materials.forEach(function (mat) {
                  var element =
                    '<div class="buttons-table-container" style="display: none;"><div class="title">' +
                    mat.title +
                    '</div><div class="buttons-table">';
                  mat.variants.forEach(function (variant, i) {
                    var style = "";
                    if (variant.type === "color") {
                      style = "background-color: " + variant.data;
                    } else if (variant.type === "texture") {
                      style = "background-image: url(" + variant.data + ")";
                    }
                    element +=
                      '<button class="variant-option" id="' +
                      mat.key +
                      "-" +
                      i +
                      '" style="' +
                      style +
                      '" data-material="' +
                      mat.key +
                      '" data-type="' +
                      variant.type +
                      '" data-value="' +
                      variant.data +
                      '"></button>';
                  });
                  element += '<div style="clear: both"></div></div></div>';
                  e.insertAdjacentHTML("beforeend", element);
                  changeMaterial({
                    material: mat.key,
                    type: mat.variants[0].type,
                    value: mat.variants[0].data,
                  });

                  document
                    .querySelectorAll(".buttons-table-container")
                    .forEach(function (elm) {
                      elm.style.display = "block";
                    });
                  document
                    .querySelectorAll(".variant-option")
                    .forEach(function (elm) {
                      elm.addEventListener("click", function (event) {
                        let data = event.target.dataset;
                        changeMaterial(data);
                      });
                    });
                });
              });

              const changeMaterial = function (data) {
                let material = meshMaterials.find(
                  (m) => m.id === data.material
                );
                if (data.type === "color") {
                  material.channels.albedoColor.color = data.value;
                  api.setMaterial(material);
                } else if (data.type === "texture") {
                  // if (material.channels.albedoTexture) {
                  //   api.updateTexture(material.channels.albedoTexture.texture.id, data.type);
                  // } else {
                  api.addTexture(data.value, function (textureId) {
                    api.updateMaterialChannel(
                      material.id,
                      "albedoTexture",
                      textureId
                    );
                  });
                  // }
                }
              };
            });
          },
          onError: function onErrorFn(e) {
            console.log(e);
            console.log("Viewer error");
          },
        });
      };
    </script>
  </body>
</html>
